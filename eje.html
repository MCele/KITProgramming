<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Ordenar Marcadores</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <!--<script src="https://aframe.io/releases/0.9.1/aframe.min.js"></script>-->
    <script src="/aframe.min.js"></script>
    <!--<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"></script>-->
    <script src="/aframe-ar.js"></script>
    <!--<script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>-->
    <script src="/aframe-gif-shader.min.js"></script>
    <!--<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>-->
    <script src="/aframe-extras.loaders.min.js"></script>
    <script>
        function createImageNode(fileName, atlText) {

            const img = new Image();
            img.src = fileName;
            img.alt = "Imagen Fallida";

            img.height = "150";
            img.width = "150";
            img.hspace = "10";

            return img;
        }
        var see = [];

        AFRAME.registerComponent('buscamarcador', {

            tick: function () {

                let active = Array.prototype.slice.call(document.getElementsByClassName("marcador")).filter(x => x.object3D.visible);

                if (active.length != 0 && active[0].object3D.visible == true) {
                    let marc = active[0].object3D.el.attributes[1].value + ".png";

                    if (marc == "custom.png")
                        marc = active[0].object3D.el.attributes[3].value.substring(1, marc.indexOf(".") + 1) + ".png";

                    if (!see.includes(marc)) {
                        arrayImagesElement.appendChild(createImageNode(marc));
                        see.push(marc);
                    }
                }
            }
        })
    </script>
</head>

<body style='margin : 0px'>
    <a-scene embedded arjs='debugUIEnabled: false' vr-mode-ui="enabled: false">

        <a-marker class="marcador" preset='hiro'>

            <a-box buscamarcador></a-box>

        </a-marker>

        <a-marker class="marcador" preset='kanji'>

            <a-plane color="red" rotation="-90 0 0" buscamarcador></a-plane>

        </a-marker>

        <a-marker class="marcador" preset='custom' type='pattern' url='/vasija.patt'>

            <a-sphere></a-sphere>

        </a-marker>

        <a-entity camera></a-entity>

    </a-scene>
    <hr>
    <p id="arrayImagesElement">[</p>
</body>

</html>